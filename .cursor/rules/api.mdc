---
description: API endpoints, request/response formats, and validation
globs: ["**/*.controller.ts", "**/*.dto.ts"]
---

# API Specification

## Endpoints

### POST /shorten

- Request: `{ "url": "https://example.com/..." }`
- Response (200): `{ "code": "abc123", "short_url": "https://short.ly/abc123" }`
- Errors: 400 (Invalid URL), 500 (Server error)

### GET /{code}

- Behavior: Lookup code, increment access_count, return 301/302 redirect
- Errors: 404 (Code not found), 500 (Server error)

### GET /health

- Response (200): `{ "status": "ok" }`
- No database queries, fast response

## Error Response Format

```json
{
  "statusCode": 400,
  "message": "Error message",
  "error": "Error Type",
  "requestId": "uuid-here"
}
```

## Status Codes

- `200`: Success
- `301/302`: Redirect
- `400`: Bad Request
- `404`: Not Found
- `500`: Internal Server Error

## Validation

- URL: Must be valid HTTP/HTTPS, start with http:// or https://, valid domain
- Use NestJS validation pipes for DTOs
- Return standardized error format on validation failure
- Include requestId in all responses

## API Documentation

- Swagger/OpenAPI documentation available at `/api` endpoint
- Use `@nestjs/swagger` decorators on DTOs and controllers
- DTOs should be classes (not interfaces) for Swagger schema generation
- Document all endpoints, request/response schemas, and error responses
